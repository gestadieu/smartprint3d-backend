extends admin_layout.pug

block content 
  form(method="get")
    div(class="columns")
      div(class="column is-9")
        h1(class="title") #{title}
      div(class="column is-2")
        input(class="input is-small" type="text" placeholder="Search Status, Contacts, Objects" name="search" value=search) 
      div(class="column is-1")
        if search
          a(class="button is-small is-danger" href=url_page) Clear
        else 
          button(class="button is-small is-dark" type="submit") Search

  table(class="table is-striped is-fullwidth is-narrow")
    thead
      tr
        th Contact / Order #
        th 
        th Online
        th Order 
        th Status 
        th(colspan="2") Timeline
        if page != 'past'
          th Action
          th Delete
    tbody
      each order in orders
        tr
          td 
            a(href="/api/orders/" + order._id  class="button is-small is-light" target="postsurvey") 
              if order.status == '03.PRINTED' 
                span.has-text-primary POST-SURVEY 
              else 
                span STATUS
          td(style="font-size:0.5rem")
            span #{order.email} 
            if order.email
              br
            span #{order.mobile}
            br 
            a(href="/qrcodes/" + order._id + ".png") #{order._id}
          td(class="is-size-7")
            if order.is_online 
              span ONLINE 
            else 
              span ON-SITE
            br 
            a(href=`${url_api}${order._id}/online`) swap
          td(class="is-size-7")
            each it in order.items
              span #{it.qty} x 
              span #{it.item} 
              br
          td
            p(class="field")
              if order.status == '01.ORDERED'
                span(class="tag is-black is-light")=order.status
              else if order.status == '02.PRINTING'
                span(class="tag is-info is-light")=order.status
              else if order.status == '03.PRINTED'
                span(class="tag is-warning is-light")=order.status
              else if order.status == '04.DELIVERED'
                span(class="tag is-success is-light")=order.status  
              else if order.status == 'DELETED'
                span(class="tag is-danger is-light")=order.status  
          
          td(class="timeline")
            each ti in order.timeline 
              span(class=(ti.status == '01.ORDERED')? "has-text-black":(ti.status == '02.PRINTING')?"has-text-info":(ti.status == '03.PRINTED')?"has-text-warning":(ti.status=='DELETED')?"has-text-danger":"has-text-success") #{ti.status} 
              br
          td(class="timeline")
            each ti in order.timeline 
              on
              span #{ti.date.toDateString()} #{ti.date.getHours()}:#{ti.date.getMinutes()}
              br
          if page != 'past'
            td(class="actions")
              if page != 'deleted'
                div.buttons.are-small.has-addons.is-centered
                  if order.status == '01.ORDERED'
                    a(href=url_api + order._id +"/flag/02.printing" class="button is-info is-small") PRINTING&raquo;
                  else if order.status == '02.PRINTING'
                  
                    a(href=url_api + order._id +"/flag/01.ordered" class="button is-black") &laquo;ORDERED 
                    a(href=url_api + order._id +"/flag/03.printed" class="button is-warning") PRINTED&raquo;
                  else if order.status == '03.PRINTED'
                    a(href=url_api + order._id +"/flag/02.printing" class="button is-info is-small") &laquo;PRINTING
          
          td 
            div.buttons.is-centered
              if order.status != 'DELETED'
                a(href=url_api + order._id + "/flag/deleted" class="button is-danger is-small")
                  span(class="icon")
                    i(class="fas fa-ban")
              else 
                a(href='/admin/orders/' + order._id + "/flag/01.ordered" class="button is-success is-small")
                  span(class="icon")
                    i(class="fas fa-undo")


                
                
